# ì‹œìŠ¤í…œ ê°„ ì—°ë™ ì´ìŠˆ ë¶„ì„ (2025-01-14)

> ì±„íŒ…, ì—ë””í„°, ê²€ìˆ˜, ë²ˆì—­ ì‹œìŠ¤í…œ ê°„ ìœ ê¸°ì  ê´€ê³„ ì½”ë“œ ë¦¬ë·° ê²°ê³¼

**ì§„í–‰ ìƒí™© ì¶”ì **: [`docs/issues_progress.md`](./issues_progress.md)

## ëª©ì°¨

- [ê°œìš”](#ê°œìš”)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [ì´ìŠˆ ë¶„ë¥˜](#ì´ìŠˆ-ë¶„ë¥˜)
  - [CRITICAL - ì¦‰ì‹œ ìˆ˜ì • í•„ìš”](#critical---ì¦‰ì‹œ-ìˆ˜ì •-í•„ìš”)
  - [HIGH - ì‹¬ê°í•œ ë²„ê·¸](#high---ì‹¬ê°í•œ-ë²„ê·¸)
  - [MEDIUM - ìˆ˜ì • ê¶Œì¥](#medium---ìˆ˜ì •-ê¶Œì¥)
  - [LOW - ê°œì„  ê¶Œì¥](#low---ê°œì„ -ê¶Œì¥)
- [ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤](#ìµœì•…ì˜-ì‹œë‚˜ë¦¬ì˜¤)
- [ê¶Œì¥ ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸](#ê¶Œì¥-ëª¨ë‹ˆí„°ë§-í¬ì¸íŠ¸)
- [íŒŒì¼ë³„ ì˜í–¥ë„](#íŒŒì¼ë³„-ì˜í–¥ë„)
- [ë³‘ë ¬ ì§„í–‰ ì „ëµ](#ë³‘ë ¬-ì§„í–‰-ì „ëµ)

---

## ê°œìš”

ë³¸ ë¬¸ì„œëŠ” OddEyes.aiì˜ í•µì‹¬ ì‹œìŠ¤í…œ(ì±„íŒ…, ì—ë””í„°, ê²€ìˆ˜, ë²ˆì—­) ê°„ ë°ì´í„° íë¦„ ë° ìƒíƒœ ë™ê¸°í™”ë¥¼ ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.

**ë¶„ì„ ëŒ€ìƒ**:
- Chat System: `src/ai/chat.ts`, `src/stores/chatStore.ts`, `src/components/chat/`
- Editor System: `src/editor/`, `src/components/panels/SourcePanel.tsx`, `TargetPanel.tsx`
- Review System: `src/ai/review/`, `src/stores/reviewStore.ts`, `src/components/review/`
- Translation System: `src/ai/translateDocument.ts`

**ë°œê²¬ëœ ì´ìŠˆ**: ì´ 13ê°œ
- CRITICAL: 1ê°œ
- HIGH: 4ê°œ
- MEDIUM: 6ê°œ
- LOW: 2ê°œ

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROJECT STORE (projectStore.ts)          â”‚
â”‚  - Master project data (blocks, segments, documents)        â”‚
â”‚  - sourceDocJson / targetDocJson (TipTap JSON cache)       â”‚
â”‚  - pendingDocDiff, pendingDiffs (edit state)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ â†‘ â†“ â†‘ â†“ â†‘ (bidirectional synchronization)
         â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                          â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  CHAT STORE            â”‚  â”‚  REVIEW STORE                â”‚ â”‚
â”‚  (chatStore.ts)        â”‚  â”‚  (reviewStore.ts)            â”‚ â”‚
â”‚                        â”‚  â”‚                              â”‚ â”‚
â”‚ - sessions             â”‚  â”‚ - chunks (AlignedChunk[])    â”‚ â”‚
â”‚ - currentSession       â”‚  â”‚ - results (ReviewResult[])   â”‚ â”‚
â”‚ - streamingContent     â”‚  â”‚ - highlightNonce (trigger)   â”‚ â”‚
â”‚ - streamingMetadata    â”‚  â”‚ - initializedProjectId       â”‚ â”‚
â”‚ - abortController      â”‚  â”‚                              â”‚ â”‚
â”‚ - translationRules     â”‚  â”‚                              â”‚ â”‚
â”‚ - projectContext       â”‚  â”‚                              â”‚ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
     â”‚                                                         â”‚
     â”œâ”€ streamAssistantReply() â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚  (src/ai/chat.ts)
     â”‚
     â””â”€ Tool Calling Loop:
        - Document Tools (on-demand access)
        - Translation Rule Tools
        - Web Search Tools
        - Review Tools
        - MCP Tools (Confluence, Notion)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        TRANSLATION SYSTEM (translateDocument.ts)            â”‚
â”‚  - translateSourceDocToTargetDocJson()                      â”‚
â”‚  - Markdown pipeline: JSON â†’ Markdown â†’ LLM â†’ Markdown     â”‚
â”‚  - Chunked translation on timeout                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì˜ì¡´ì„± ì²´ì¸

```
sendMessage() [chatStore]
â”œâ†’ streamAssistantReply() [chat.ts]
â”‚  â”œâ†’ get_source_document tool
â”‚  â”‚  â””â†’ sourceDocJson [projectStore] âš ï¸ Can be stale
â”‚  â”œâ†’ get_target_document tool
â”‚  â”‚  â””â†’ targetDocJson [projectStore] âš ï¸ Can be stale
â”‚  â”œâ†’ suggest_translation_rule tool
â”‚  â”‚  â””â†’ translationRules [chatStore]
â”‚  â””â†’ onToken/onToolCall callbacks
â”‚     â”œâ†’ streamingContent [chatStore]
â”‚     â””â†’ streamingMetadata [chatStore]
â”œâ†’ finalizeStreaming() [chatStore]
â”‚  â””â†’ updateMessage() [chatStore]
â”‚     â””â†’ messages array

runReview() [ReviewPanel]
â”œâ†’ buildAlignedChunks() [reviewTool]
â”‚  â””â†’ project.blocks [projectStore]
â”œâ†’ streamAssistantReply() [chat.ts]
â”‚  â””â†’ translationRules [chatStore] âš ï¸ Captured at render
â””â†’ addResult() / handleChunkError() [reviewStore]
   â””â†’ results array

hydrateForProject() [chatStore]
â”œâ†’ loadChatSessions() [Tauri]
â”œâ†’ loadChatProjectSettings() [Tauri]
â”œâ†’ listAttachments() [Tauri]
â””â†’ activeProjectId check
   â””â†’ project.id [projectStore] âš ï¸ Race window

initializeProject() [projectStore]
â””â†’ hydrateForProject() [chatStore] âš ï¸ Async side-effect
```

---

## ì´ìŠˆ ë¶„ë¥˜

### CRITICAL - ì¦‰ì‹œ ìˆ˜ì • í•„ìš”

#### Issue #4: TipTap JSON ìºì‹œ ë™ê¸°í™” ë¶ˆì¼ì¹˜

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸ”´ CRITICAL |
| **ìœ„ì¹˜** | `src/stores/projectStore.ts:358-360, 816-817` |
| **ì¹´í…Œê³ ë¦¬** | State Inconsistency |

**ë¬¸ì œ ì„¤ëª…**:

`sourceDocJson`ê³¼ `targetDocJson`ì€ í”„ë¡œì íŠ¸ ë¡œë“œ ì‹œ HTMLì—ì„œ ë³€í™˜ë˜ì–´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤:

```typescript
// projectStore.ts:359-360
sourceDocJson: htmlToTipTapJson(sd.text),
targetDocJson: htmlToTipTapJson(td.text),
```

ê·¸ëŸ¬ë‚˜ TipTap ì—ë””í„°ì˜ ì‹¤ì‹œê°„ ìˆ˜ì •ì‚¬í•­ì´ ì´ ìºì‹œì— ì¦‰ì‹œ ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. `setSourceDocJson()`/`setTargetDocJson()` ë©”ì„œë“œê°€ ì¡´ì¬í•˜ì§€ë§Œ, ì—ë””í„°ì—ì„œë§Œ í˜¸ì¶œë˜ë©° ëª¨ë“  ìˆ˜ì • ê²½ë¡œë¥¼ ì»¤ë²„í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

**ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤**:

```
1. T0: í”„ë¡œì íŠ¸ ë¡œë“œ â†’ sourceDocJson = "Hello"
2. T1: ì‚¬ìš©ìê°€ ì—ë””í„°ì—ì„œ "Hello World"ë¡œ ìˆ˜ì • (ì‹œê°ì  ë‚´ìš© ë³€ê²½)
3. T2: ì‚¬ìš©ìê°€ AIì—ê²Œ ë¬¸ì„œ ê´€ë ¨ ì§ˆë¬¸ â†’ get_source_document ë„êµ¬ í˜¸ì¶œ
4. T3: ë„êµ¬ê°€ useProjectStore.getState().sourceDocJson ì°¸ì¡°
5. ê²°ê³¼: AIëŠ” "Hello"ë§Œ ë´„ (ìµœì‹  "Hello World" ì•„ë‹˜)
```

**ì˜í–¥**:
- AI ë„êµ¬ê°€ ì˜¤ë˜ëœ ë¬¸ì„œ ë‚´ìš©ìœ¼ë¡œ ì‘ì—…
- ë¶€ì •í™•í•œ ë²ˆì—­ ê²°ê³¼
- ì‚¬ìš©ìì—ê²Œ ì˜ëª»ëœ ì œì•ˆ ì œê³µ

**ê´€ë ¨ ì½”ë“œ íë¦„**:
```
ì—ë””í„° ìˆ˜ì • â†’ TipTap ë‚´ë¶€ ìƒíƒœ ì—…ë°ì´íŠ¸
           â†’ onUpdate ì½œë°± (ìˆë‹¤ë©´)
           â†’ setSourceDocJson() í˜¸ì¶œ í•„ìš” âŒ (ëˆ„ë½ ê°€ëŠ¥)

AI ë„êµ¬ í˜¸ì¶œ â†’ documentTools.ts
            â†’ useProjectStore.getState().sourceDocJson
            â†’ stale ë°ì´í„° ë°˜í™˜
```

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
1. TipTap `onUpdate` ì½œë°±ì—ì„œ JSON ìºì‹œ ë™ê¸°í™” ë³´ì¥
2. Document toolsì—ì„œ í˜¸ì¶œ ì‹œ ì—ë””í„°ì—ì„œ ì§ì ‘ JSON ì¶”ì¶œ ê³ ë ¤
3. ìºì‹œ ë¬´íš¨í™” ë©”ì»¤ë‹ˆì¦˜ ë„ì…

---

### HIGH - ì‹¬ê°í•œ ë²„ê·¸

#### Issue #1: ìŠ¤íŠ¸ë¦¬ë° ë©”ì‹œì§€ ì™„ë£Œ Race Condition

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸ”´ HIGH |
| **ìœ„ì¹˜** | `src/stores/chatStore.ts:799-920` |
| **ì¹´í…Œê³ ë¦¬** | Race Condition |

**ë¬¸ì œ ì„¤ëª…**:

`streamAssistantReply()` í˜¸ì¶œ ì‹œ `onToken`ê³¼ `onToolCall` ì½œë°±ì´ `streamingContent`ì™€ `streamingMetadata`ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ì´ ì—…ë°ì´íŠ¸ë“¤ì€ ì„±ëŠ¥ì„ ìœ„í•´ `messages` ë°°ì—´ ê°±ì‹  ì—†ì´ ë‹¨ì¼ í•„ë“œë§Œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤ (line 832-833).

`finalizeStreaming()` (line 1699)ì—ì„œ ì´ë“¤ì„ í•©ì³ ë‹¨ì¼ `updateMessage()` í˜¸ì¶œì„ í•©ë‹ˆë‹¤.

**Race ë°œìƒ ì¡°ê±´**:
`finalizeStreaming()` ì™„ë£Œ ì „ì— ìƒˆë¡œìš´ `sendMessage()` í˜¸ì¶œ ì‹œ:

```typescript
// Line 796: streamingMessageId ì„¤ì •
// Lines 828-833: onToken ì½œë°± â†’ set { streamingContent }
// Lines 835-891: onToolCall ì½œë°± â†’ set { streamingMetadata }
// Lines 905-919: ì‘ë‹µ í›„ finalizeStreaming() í˜¸ì¶œ
// RACE: Lines 781-788ì˜ ìƒˆ sendMessageê°€ finalization ì „ì— ì‹¤í–‰ë  ìˆ˜ ìˆìŒ
```

**ì˜í–¥**:
- ë©”ì‹œì§€ ì†ìƒ
- ë„êµ¬ ì •ë³´ ì¤‘ë³µ/ëˆ„ë½
- UI ë¶ˆì¼ì¹˜

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- `isFinalizingStreaming` ê°€ë“œ í”Œë˜ê·¸ ì¶”ê°€
- ìƒˆ ìš”ì²­ ìˆ˜ë½ ì „ finalization ì™„ë£Œ ëŒ€ê¸°

---

#### Issue #2: AbortController ì •ë¦¬ ëˆ„ë½

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸ”´ HIGH |
| **ìœ„ì¹˜** | `src/stores/chatStore.ts:610-650, 1461-1479` |
| **ì¹´í…Œê³ ë¦¬** | Resource Leak |

**ë¬¸ì œ ì„¤ëª…**:

```typescript
// Line 610-614: ì´ì „ abortController ì¤‘ë‹¨
const prevAbortController = get().abortController;
if (prevAbortController) {
  prevAbortController.abort();
  set({ abortController: null });  // ì¦‰ì‹œ null ì„¤ì •
}
// Gap: abortì™€ ìƒˆ controller ìƒì„± ì‚¬ì´ì— ì˜ˆì™¸ ë°œìƒ ì‹œ ìƒíƒœ ë¶ˆì¼ì¹˜
```

**ë¬¸ì œì **:
1. ì›¹ ê²€ìƒ‰ ì‹¤íŒ¨ í›„ abort ì‹œ ì •ë¦¬ ë¶ˆì™„ì „
2. íƒ€ì„ì•„ì›ƒ ê¸°ë°˜ ì •ë¦¬ ë©”ì»¤ë‹ˆì¦˜ ì—†ìŒ
3. `deleteMessageFrom()` (line 1461-1463)ì—ì„œ abort í›„ ì •ë¦¬ ë³´ì¥ ì•ˆ ë¨

**ì˜í–¥**:
- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
- ê³ ì•„ abort signal
- ìš”ì²­ ì·¨ì†Œ ë¶ˆê°€

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- AbortController ì •ë¦¬ í êµ¬í˜„
- íƒ€ì„ì•„ì›ƒ ê¸°ë°˜ cleanup
- try-finally íŒ¨í„´ìœ¼ë¡œ ì •ë¦¬ ë³´ì¥

---

#### Issue #3: í”„ë¡œì íŠ¸ í•˜ì´ë“œë ˆì´ì…˜ Race Condition

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸ”´ HIGH |
| **ìœ„ì¹˜** | `src/stores/projectStore.ts:363-364`, `src/stores/chatStore.ts:416-420` |
| **ì¹´í…Œê³ ë¦¬** | Race Condition |

**ë¬¸ì œ ì„¤ëª…**:

`projectStore.initializeProject()` (line 363-364)ì—ì„œ `hydrateForProject()`ë¥¼ ë¹„ë™ê¸°ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤:

```typescript
// projectStore.ts
await chatStore.getState().hydrateForProject(projectId);

// chatStore.ts - Promise.allë¡œ ë³‘ë ¬ ì‹¤í–‰
const [sessions, settings, attachments] = await Promise.all([
  loadChatSessions(projectId),
  loadChatProjectSettings(projectId),
  listAttachments(projectId),
]);
```

**Race íƒ€ì„ë¼ì¸**:

```
T0: initializeProject() í˜¸ì¶œ
T1: isHydrating = true (ì–‘ìª½ store)
T2: tauriLoadProject() ì™„ë£Œ
T3: sourceDocJson/targetDocJson ì„¤ì • (line 359-360)
T4: hydrateForProject() ë¹„ë™ê¸° í˜¸ì¶œ
T5: chatStore Promise.all() ì‹¤í–‰ (ì„¸ì…˜, ì„¤ì •, ì²¨ë¶€íŒŒì¼ ë³‘ë ¬ ë¡œë“œ)
T6: T5 ~ ì™„ë£Œ ì‚¬ì´: ì‚¬ìš©ìê°€ í”„ë¡œì íŠ¸ ì „í™˜í•˜ë©´?
T7: chatStoreê°€ ë¡œë“œëœ ìƒíƒœ ì ìš© (ì˜ëª»ëœ í”„ë¡œì íŠ¸ì—)
```

**ì˜í–¥**:
- ì˜ëª»ëœ í”„ë¡œì íŠ¸ì— ì±„íŒ… ì„¸ì…˜ ë¡œë“œ
- ì˜¤ë˜ëœ ë¬¸ì„œ ìºì‹œ ì‚¬ìš©

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- í•˜ì´ë“œë ˆì´ì…˜ ë‹¨ê³„ ìˆœì°¨ ì‹¤í–‰
- í”„ë¡œì íŠ¸ ID ê²€ì¦ ê°•í™”
- í”„ë¡œì íŠ¸ ì „í™˜ ì‹œ ì§„í–‰ ì¤‘ì¸ í•˜ì´ë“œë ˆì´ì…˜ ì·¨ì†Œ

---

#### Issue #9: ì±„íŒ… ì €ì¥ Debounce vs í”„ë¡œì íŠ¸ ì €ì¥ Race

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸ”´ HIGH |
| **ìœ„ì¹˜** | `src/stores/chatStore.ts:259-305` |
| **ì¹´í…Œê³ ë¦¬** | Race Condition |

**ë¬¸ì œ ì„¤ëª…**:

`schedulePersist()`ëŠ” `CHAT_PERSIST_DEBOUNCE_MS = 800` (line 34)ìœ¼ë¡œ ì±„íŒ… ì €ì¥ì„ ì§€ì—°í•©ë‹ˆë‹¤.
`projectStore.switchProjectById()`ëŠ” ì¦‰ì‹œ `saveProject()`ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

**Race íƒ€ì„ë¼ì¸**:

```
T0: ì‚¬ìš©ì ì±„íŒ… ì…ë ¥ â†’ schedulePersist() (800ms ì§€ì—° ì‹œì‘)
T0+100ms: ì‚¬ìš©ìê°€ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ í´ë¦­ â†’ switchProjectById()
T0+100ms: saveProject() í˜¸ì¶œ (í”„ë¡œì íŠ¸ ì „í™˜, T0+101ì— ì™„ë£Œ)
T0+300ms: chatStore.loadedProjectIdê°€ ìƒˆ í”„ë¡œì íŠ¸ë¡œ ë³€ê²½
T0+800ms: chatPersistTimer ë°œë™ â†’ persistNow()
         loadedProjectId = newProject
         â†’ ìƒˆ í”„ë¡œì íŠ¸ ì±„íŒ…ì— êµ¬ ì„¸ì…˜ ë°ì´í„° ì €ì¥!
```

**ì˜í–¥**:
- í”„ë¡œì íŠ¸ ê°„ ì±„íŒ… ì„¸ì…˜ ì†ìƒ
- ë°ì´í„° ì†ì‹¤
- ì‚¬ìš©ì í˜¼ë€

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- í”„ë¡œì íŠ¸ë³„ íƒ€ì´ë¨¸ ì‚¬ìš©
- í”„ë¡œì íŠ¸ ì „í™˜ ì‹œ pending persist ì¦‰ì‹œ ì‹¤í–‰ ë˜ëŠ” ì·¨ì†Œ
- persist ì‹œ í”„ë¡œì íŠ¸ ID ì¬ê²€ì¦

---

### MEDIUM - ìˆ˜ì • ê¶Œì¥

#### Issue #5: pendingDocDiff ìƒíƒœ ë¯¸ì •ë¦¬

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸŸ¡ MEDIUM |
| **ìœ„ì¹˜** | `src/stores/projectStore.ts:503-526, 771-799` |
| **ì¹´í…Œê³ ë¦¬** | State Inconsistency |

**ë¬¸ì œ ì„¤ëª…**:

`loadProject()` (line 524)ì—ì„œëŠ” `pendingDocDiff: null`ì„ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•˜ì§€ë§Œ,
`switchProjectById()` (line 771-799)ì—ì„œëŠ” ì´ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```typescript
// Line 523-524 in loadProject
set({
  // ...
  pendingDocDiff: null,  // ëª…ì‹œì  ì •ë¦¬
});

// Line 771-799 in switchProjectById
async (projectId: string): Promise<void> => {
  // ... save and load logic
  loadProject(loaded);  // loadProject í˜¸ì¶œë¡œ ì •ë¦¬ë˜ê¸´ í•¨
  // í•˜ì§€ë§Œ íƒ€ì´ë°ì´ ì¤‘ìš” - loadProjectê°€ ë¹„ë™ê¸°ë©´ race window ì¡´ì¬
}
```

**ì˜í–¥**:
- Diff UIê°€ stale ìƒíƒœ í‘œì‹œ
- diff ì ìš© ì‹œ ì˜ëª»ëœ í”„ë¡œì íŠ¸ì— ì ìš©

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- `switchProjectById()`ì—ì„œ ëª…ì‹œì  ì •ë¦¬ ì¶”ê°€

---

#### Issue #6: ê²€ìˆ˜ í•˜ì´ë¼ì´íŠ¸ vs ë¬¸ì„œ ë³€ê²½ ë¶ˆì¼ì¹˜

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸŸ¡ MEDIUM |
| **ìœ„ì¹˜** | `src/stores/reviewStore.ts:209-243, 301-319` |
| **ì¹´í…Œê³ ë¦¬** | State Synchronization |

**ë¬¸ì œ ì„¤ëª…**:

`highlightEnabled` (line 209)ì™€ `highlightNonce` (line 210)ëŠ” UI ìƒíƒœì…ë‹ˆë‹¤.
ë¬¸ì„œê°€ ë³€ê²½ë˜ì–´ë„ í•˜ì´ë¼ì´íŠ¸ê°€ í™œì„± ìƒíƒœë¡œ ìœ ì§€ë˜ë©°, ìœ„ì¹˜ ì˜¤í”„ì…‹ì´ í‹€ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‹œë‚˜ë¦¬ì˜¤**:

```
1. ê²€ìˆ˜: ìœ„ì¹˜ [100-150]ì—ì„œ ì´ìŠˆ ë°œê²¬
2. highlightEnabled = true
3. ì‚¬ìš©ìê°€ Target ë¬¸ì„œ í¸ì§‘ (ìœ„ì¹˜ 80ì— 50ì ì¶”ê°€)
4. í•˜ì´ë¼ì´íŠ¸ê°€ ì—¬ì „íˆ [100-150] ê°€ë¦¬í‚´
5. ì‹¤ì œ ë¬¸ì œ í…ìŠ¤íŠ¸ëŠ” [150-200]ìœ¼ë¡œ ì´ë™ë¨
6. í•˜ì´ë¼ì´íŠ¸ê°€ ì˜ëª»ëœ í…ìŠ¤íŠ¸ í‘œì‹œ
```

**ì˜í–¥**:
- í•˜ì´ë¼ì´íŠ¸ê°€ ì˜ëª»ëœ í…ìŠ¤íŠ¸ ê°€ë¦¬í‚´
- ì‚¬ìš©ì í˜¼ë€

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- ë¬¸ì„œ í¸ì§‘ ì‹œ í•˜ì´ë¼ì´íŠ¸ ìœ„ì¹˜ ì¬ê³„ì‚° ë˜ëŠ” ë¬´íš¨í™”
- í¸ì§‘ ì´ë²¤íŠ¸ ê°ì§€í•˜ì—¬ `highlightEnabled = false` ì„¤ì •

---

#### Issue #7: streamAssistantReply ë¶ˆì™„ì „í•œ ì—ëŸ¬ ë³µêµ¬

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸŸ¡ MEDIUM |
| **ìœ„ì¹˜** | `src/stores/chatStore.ts:923-958` |
| **ì¹´í…Œê³ ë¦¬** | Error Handling |

**ë¬¸ì œ ì„¤ëª…**:

Catch ë¸”ë¡ (line 924)ì—ì„œ `AbortError`ëŠ” íŠ¹ë³„ ì²˜ë¦¬í•˜ì§€ë§Œ (lines 926-935),
non-abort ì—ëŸ¬ì˜ ê²½ìš°:
- `composerAttachments` ì •ë¦¬ ì•ˆ ë¨ (line 903ì€ ì„±ê³µ ì‹œì—ë§Œ ì‹¤í–‰)
- `streamingMessageId`ê°€ nullì´ë©´ ì—ëŸ¬ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ
- `statusMessage`ê°€ ë¡œë”© ìƒíƒœë¡œ ë‚¨ìŒ

```typescript
// Line 720: ë¡œë”© ì„¤ì •, statusMessage ì •ë¦¬
set({ isLoading: true, error: null, statusMessage: 'ìš”ì²­ ë¶„ì„...' });

// Lines 790-796: ì–´ì‹œìŠ¤í„´íŠ¸ ë©”ì‹œì§€ ìƒì„±
const assistantId = addMessage({...});
if (assistantId) {
  set({ streamingMessageId: assistantId });
}
// ë¬¸ì œ: addMessageê°€ null ë°˜í™˜í•˜ë©´ streamingMessageIdëŠ” null ìœ ì§€

// Lines 938-948: ì—ëŸ¬ ë°œìƒ ì‹œ
if (assistantId) {  // assistantIdê°€ ì—¬ê¸°ì„œ undefined
  get().updateMessage(assistantId, {...});  // ì‹¤í–‰ ì•ˆ ë¨
}
```

**ì˜í–¥**:
- ì—ëŸ¬ê°€ ì¡°ìš©íˆ ì‹¤íŒ¨
- status message ì—…ë°ì´íŠ¸ ì•ˆ ë¨
- ì‚¬ìš©ìê°€ ë¬´í•œ ëŒ€ê¸°

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- finally ë¸”ë¡ì—ì„œ ìƒíƒœ ì •ë¦¬
- `streamingMessageId` null ì²´í¬ í›„ ëŒ€ì²´ ì—ëŸ¬ í‘œì‹œ

---

#### Issue #8: ê²€ìˆ˜ ë„êµ¬ ì—ëŸ¬ ì‹œ ìƒíƒœ ë¡¤ë°± ì—†ìŒ

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸŸ¡ MEDIUM |
| **ìœ„ì¹˜** | `src/components/review/ReviewPanel.tsx:136-150, 177-180` |
| **ì¹´í…Œê³ ë¦¬** | Error Handling |

**ë¬¸ì œ ì„¤ëª…**:

```typescript
try {
  for (let i = 0; i < freshChunks.length; i++) {
    // ...
    const response = await streamAssistantReply({...});  // ì˜ˆì™¸ ë°œìƒ ê°€ëŠ¥
    const parsed = parseReviewResult(response);  // ì˜ˆì™¸ ë°œìƒ ê°€ëŠ¥
    addResult({...});  // ìƒíƒœ ì—…ë°ì´íŠ¸
    // ì—¬ê¸°ì— ì—ëŸ¬ ì²˜ë¦¬ ì—†ìŒ
  }
} catch (e) {
  // Lines 181-186: ì¼ë°˜ ì—ëŸ¬ í•¸ë“¤ëŸ¬ê°€ finishReview() í˜¸ì¶œ
}
```

**ë¬¸ì œì **:
- AI ì—ëŸ¬ ë°œìƒ ì‹œ (ì˜ˆ: chunk 3/5 ì‹¤íŒ¨) `isReviewing`ì´ true ìœ ì§€
- UIê°€ ì—ëŸ¬ í‘œì‹œ ì—†ì´ ë©ˆì¶¤
- `parseReviewResult()`ì— try-catch ë˜í•‘ ì—†ìŒ

**ì˜í–¥**:
- ê²€ìˆ˜ ë©ˆì¶¤
- ìˆ˜ë™ ë¦¬ì…‹ í•„ìš”
- ë¶€ë¶„ ê²°ê³¼ ì†ì‹¤

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- `parseReviewResult()` try-catch ë˜í•‘
- ì²­í¬ë³„ ì—ëŸ¬ ì²˜ë¦¬ ë° ë¶€ë¶„ ê²°ê³¼ ë³´ì¡´
- ì—ëŸ¬ ì‹œ `isReviewing = false` ë³´ì¥

---

#### Issue #11: ìŠ¤íŠ¸ë¦¬ë° ë©”íƒ€ë°ì´í„° ì†ì‹¤

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸŸ¡ MEDIUM |
| **ìœ„ì¹˜** | `src/stores/chatStore.ts:835-891, 1699-1719` |
| **ì¹´í…Œê³ ë¦¬** | Data Loss |

**ë¬¸ì œ ì„¤ëª…**:

`onToolCall` with `phase === 'end'` (line 855-857)ê°€ `toolCallsInProgress`ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
ê·¸ëŸ¬ë‚˜ `finalizeStreaming()` (line 1707)ì—ì„œ `toolCallsInProgress: []`ë¡œ í•˜ë“œì½”ë”©í•©ë‹ˆë‹¤.

```typescript
// Line 840-891: onToolCallì´ ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
if (evt.phase === 'start') { /* ... */ }
else {
  // phase === 'end'
  set({ statusMessage: 'ê²°ê³¼ ì²˜ë¦¬...' });
  set({
    streamingMetadata: {
      ...nextMetadata,
      toolCallsInProgress: next,  // ë³‘ë ¬ ë„êµ¬ê°€ ìˆìœ¼ë©´ ì•„ì§ ë‚¨ì•„ìˆì„ ìˆ˜ ìˆìŒ
    }
  });
}

// Line 1707: finalizeStreamingì´ hardcodeë¡œ ë¹ˆ ë°°ì—´ ì„¤ì •
metadata: { ...streamingMetadata, toolCallsInProgress: [] }
// ìµœì¢… ë©”íƒ€ë°ì´í„° ìƒíƒœ ì†ì‹¤!
```

**ì˜í–¥**:
- ìµœì¢… ë„êµ¬ í˜¸ì¶œ ìƒíƒœ ì†ì‹¤
- UIê°€ ì™„ì „í•œ ë„êµ¬ ì‹¤í–‰ ë°˜ì˜ ëª»í•¨

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- `finalizeStreaming()`ì—ì„œ ë©”íƒ€ë°ì´í„° ë³´ì¡´
- ë˜ëŠ” ë³„ë„ í•„ë“œë¡œ ì™„ë£Œëœ ë„êµ¬ ê¸°ë¡

---

#### Issue #13: ê²€ìˆ˜ ì‹œ ë²ˆì—­ ê·œì¹™ ìŠ¤ëƒ…ìƒ· ë¬¸ì œ

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸŸ¡ MEDIUM |
| **ìœ„ì¹˜** | `src/components/review/ReviewPanel.tsx:62-63, 137-147` |
| **ì¹´í…Œê³ ë¦¬** | State Synchronization |

**ë¬¸ì œ ì„¤ëª…**:

```typescript
const translationRules = useChatStore((s) => s.translationRules);  // Line 62
const projectContext = useChatStore((s) => s.projectContext);

const runReview = useCallback(async () => {
  // ...
  const response = await streamAssistantReply(
    {
      // ...
      translationRules,  // ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì‹œì ì— ìº¡ì²˜ëœ ê°’
      projectContext,    // ê·œì¹™ì´ ë³€ê²½ë˜ì–´ë„ stale ê°’ ì‚¬ìš©
    },
    // ...
  );
```

**ì‹œë‚˜ë¦¬ì˜¤**:
1. ì‚¬ìš©ìê°€ ê²€ìˆ˜ ì‹œì‘
2. ê²€ìˆ˜ ì¤‘ Settings íƒ­ì—ì„œ ë²ˆì—­ ê·œì¹™ ìˆ˜ì •
3. ê²€ìˆ˜ê°€ êµ¬ ê·œì¹™ìœ¼ë¡œ ê³„ì† ì§„í–‰

**ì˜í–¥**:
- ê²€ìˆ˜ê°€ ì˜¤ë˜ëœ ë²ˆì—­ ê·œì¹™ ì‚¬ìš©
- ì¼ê´€ì„± ì—†ëŠ” ê²°ê³¼

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- ê° ì²­í¬ ì²˜ë¦¬ ì‹œ ìµœì‹  ê·œì¹™ ê°€ì ¸ì˜¤ê¸°
- ë˜ëŠ” ê·œì¹™ ë³€ê²½ ì‹œ ì§„í–‰ ì¤‘ì¸ ê²€ìˆ˜ ê²½ê³ /ì¤‘ë‹¨

---

### LOW - ê°œì„  ê¶Œì¥

#### Issue #10: Document Tools null ì²´í¬ ì—†ìŒ

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸŸ¢ LOW |
| **ìœ„ì¹˜** | `src/ai/tools/documentTools.ts` |
| **ì¹´í…Œê³ ë¦¬** | Defensive Programming |

**ë¬¸ì œ ì„¤ëª…**:

Document toolsê°€ `useProjectStore.getState().sourceDocJson`ì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ë§Œ,
JSONì´ ì œëŒ€ë¡œ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ê²½ìš°(null/undefined) ê²€ì¦ì´ ì—†ìŠµë‹ˆë‹¤.

`htmlToTipTapJson()` ë³€í™˜ ì‹¤íŒ¨ ì‹œ JSONì´ nullì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì˜í–¥**:
- ë„êµ¬ í¬ë˜ì‹œ
- ì‚¬ìš©ìì—ê²Œ ì•”í˜¸ ê°™ì€ ì—ëŸ¬ ë©”ì‹œì§€

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- null ì•ˆì „ì„± ê²€ì‚¬ ì¶”ê°€
- ì˜ë¯¸ ìˆëŠ” ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜

---

#### Issue #12: composerAttachments ì¡°ê¸° ì •ë¦¬

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‹¬ê°ë„** | ğŸŸ¢ LOW |
| **ìœ„ì¹˜** | `src/stores/chatStore.ts:903, 1399` |
| **ì¹´í…Œê³ ë¦¬** | UX |

**ë¬¸ì œ ì„¤ëª…**:

```typescript
// Line 903: ì„±ê³µì ì¸ ì‘ë‹µ í›„ ì‹¤í–‰
set({ composerAttachments: [] })
```

ì„¤ê³„ìƒ ì˜ë„ëœ ë™ì‘(ì¼íšŒìš© ì²¨ë¶€íŒŒì¼)ì´ì§€ë§Œ,
`streamAssistantReply()` ì„±ê³µ í›„ `finalizeStreaming()` ì‹¤íŒ¨ ì‹œ ì²¨ë¶€íŒŒì¼ì´ ì´ë¯¸ ì •ë¦¬ë¨.

**ì‹œë‚˜ë¦¬ì˜¤**:
1. ì‚¬ìš©ì íŒŒì¼ ì²¨ë¶€, ì§ˆë¬¸ ì‘ì„±
2. ìš”ì²­ ì „ì†¡, ì²¨ë¶€íŒŒì¼ payloadì— í¬í•¨
3. ì‘ë‹µ ì„±ê³µ
4. ì²¨ë¶€íŒŒì¼ ì •ë¦¬ (line 903)
5. finalizeStreaming() ì–´ë–¤ ì´ìœ ë¡œ ì‹¤íŒ¨
6. ì‚¬ìš©ìê°€ ì¬ì‹œë„í•˜ë ¤ë©´ ì²¨ë¶€íŒŒì¼ ë‹¤ì‹œ ì¶”ê°€í•´ì•¼ í•¨

**ì˜í–¥**:
- ì˜ˆìƒì¹˜ ëª»í•œ ì²¨ë¶€íŒŒì¼ ì†ì‹¤
- ì¬ì²¨ë¶€ í•„ìš”

**ê¶Œì¥ ìˆ˜ì • ë°©í–¥**:
- finally ë¸”ë¡ì—ì„œ ì •ë¦¬
- ë˜ëŠ” finalization ì„±ê³µ í›„ì—ë§Œ ì •ë¦¬

---

## ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤

ì—¬ëŸ¬ Race Conditionì´ ë™ì‹œì— ë°œìƒí•  ë•Œì˜ íƒ€ì„ë¼ì¸:

```
T0:   í”„ë¡œì íŠ¸ ì—´ê¸°
      projectStore.initializeProject() â†’ tauriLoadProject()
      sourceDocJson = htmlToTipTapJson(...)
      chatStore.hydrateForProject(projectId) í˜¸ì¶œ

T1:   ì±„íŒ… ì„¸ì…˜ ë¡œë”© ì¤‘... (Promise.all ì§„í–‰ ì¤‘)
      ì‚¬ìš©ìê°€ ì—ë””í„° ìˆ˜ì • (ë‚´ìš© ë³€ê²½ë˜ì§€ë§Œ DocJson ë¯¸ë°˜ì˜)

T2:   ì‚¬ìš©ìê°€ ë¬¸ì„œ ê´€ë ¨ ì§ˆë¬¸
      sendMessage() â†’ streamAssistantReply()
      get_source_document ë„êµ¬ í˜¸ì¶œ
      âš ï¸ T0 ì‹œì ì˜ stale sourceDocJson ì‚¬ìš©

T3:   í•œí¸: ì´ì „ ìš”ì²­ ìŠ¤íŠ¸ë¦¬ë° ì¤‘...
      onToken() â†’ set({ streamingContent })
      onToolCall() â†’ set({ streamingMetadata })

T4:   ì‚¬ìš©ìê°€ T3 ì™„ë£Œ ì „ "ì·¨ì†Œ" í´ë¦­
      deleteMessageFrom() â†’ abortController.abort()
      âš ï¸ streamingContent/Metadata ì—…ë°ì´íŠ¸ ì§„í–‰ ì¤‘ì¼ ìˆ˜ ìˆìŒ

T5:   ìƒˆ ìš”ì²­ ì „ì†¡ (ì´ì „ abort ì§„í–‰ ì¤‘)
      createSession() í˜¸ì¶œ
      âš ï¸ ì„¸ì…˜ ì œí•œ ì²´í¬ (3ê°œ max) íŠ¸ë¦¬ê±°
      âš ï¸ abort ì™„ë£Œ ì „ì— ì²« ì„¸ì…˜ ì„ íƒë¨

T6:   ì±„íŒ… ì„¸ì…˜ ë¡œë“œ ì™„ë£Œ
      hydrateForProject() ìƒíƒœ ì ìš©
      currentSessionì´ DBì—ì„œ ë³µì›ë¨
      âš ï¸ T5ì—ì„œ ì„¤ì •í•œ currentSession ë®ì–´ì“¸ ìˆ˜ ìˆìŒ

T7:   ì²« ìš”ì²­ ìµœì¢… ì™„ë£Œ
      finalizeStreaming()ì´ ìƒíƒœ ë³‘í•©
      âš ï¸ T6ì´ ìƒíƒœ ë®ì–´ì¼ìœ¼ë©´ ì˜ëª»ëœ ì„¸ì…˜ì— ë©”ì‹œì§€ ì¶”ê°€ë¨
```

---

## ê¶Œì¥ ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸

ë””ë²„ê¹… ë° ë¬¸ì œ ì¶”ì ì„ ìœ„í•´ ë‹¤ìŒ ìœ„ì¹˜ì— ë¡œê¹… ì¶”ê°€ ê¶Œì¥:

| ìœ„ì¹˜ | ë¡œê¹… ë‚´ìš© |
|------|----------|
| `chat.ts:799-801` | `streamAssistantReply()` ì§„ì… ì‹œ `abortSignal.aborted` ìƒíƒœ |
| `chatStore.ts:919` | `finalizeStreaming()` ì „í›„ ë©”ì‹œì§€ ìˆ˜ |
| `projectStore.ts:363-364` | `hydrateForProject()` í˜¸ì¶œ íƒ€ì´ë° |
| `ReviewPanel.tsx:137` | ê²€ìˆ˜ ì‹œì‘ ì‹œ `translationRules` í•´ì‹œ |
| `chatStore.ts:630-650` | ì›¹ ê²€ìƒ‰ ê²½ë¡œì—ì„œ abort controller ìƒíƒœ |

---

## íŒŒì¼ë³„ ì˜í–¥ë„

| íŒŒì¼ | ì´ìŠˆ ìˆ˜ | ì‹¬ê°ë„ | ì£¼ìš” ë¬¸ì œ |
|------|--------|--------|----------|
| `src/stores/chatStore.ts` | 8ê°œ | HIGH | ìŠ¤íŠ¸ë¦¬ë°, abort, ì €ì¥, ì—ëŸ¬ì²˜ë¦¬ |
| `src/stores/projectStore.ts` | 4ê°œ | CRITICAL/HIGH | í•˜ì´ë“œë ˆì´ì…˜, JSON ìºì‹œ, diff ìƒíƒœ |
| `src/stores/reviewStore.ts` | 2ê°œ | MEDIUM | í•˜ì´ë¼ì´íŠ¸ ë™ê¸°í™” |
| `src/components/review/ReviewPanel.tsx` | 2ê°œ | MEDIUM | ì—ëŸ¬ì²˜ë¦¬, ì»¨í…ìŠ¤íŠ¸ |
| `src/ai/chat.ts` | 1ê°œ | LOW | ë„êµ¬ fallback |

---

## ë³‘ë ¬ ì§„í–‰ ì „ëµ

ì´ìŠˆë“¤ì˜ ì˜ì¡´ ê´€ê³„ë¥¼ ë¶„ì„í•˜ì—¬ ë³‘ë ¬ ì§„í–‰ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë¶„ë¥˜í•©ë‹ˆë‹¤.

### ì˜ì¡´ì„± ë¶„ì„ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë™ì‹œ ì§„í–‰ ê°€ëŠ¥í•œ ì‘ì—…ë“¤                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ê·¸ë£¹ A     â”‚  â”‚  ê·¸ë£¹ B     â”‚  â”‚  ê·¸ë£¹ C     â”‚         â”‚
â”‚  â”‚  (ë…ë¦½)     â”‚  â”‚  (ìŠ¤íŠ¸ë¦¬ë°)  â”‚  â”‚  (Abort)    â”‚         â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚         â”‚
â”‚  â”‚ #4 CRITICAL â”‚  â”‚ #1 HIGH    â”‚  â”‚ #2 HIGH    â”‚         â”‚
â”‚  â”‚ #6 MEDIUM  â”‚  â”‚     â†“       â”‚  â”‚     â†“       â”‚         â”‚
â”‚  â”‚ #10 LOW    â”‚  â”‚ #11 MEDIUM â”‚  â”‚ #9 HIGH    â”‚         â”‚
â”‚  â”‚ #12 LOW    â”‚  â”‚     â†“       â”‚  â”‚             â”‚         â”‚
â”‚  â”‚             â”‚  â”‚ #7 MEDIUM  â”‚  â”‚             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  ê·¸ë£¹ D     â”‚  â”‚  ê·¸ë£¹ E     â”‚                          â”‚
â”‚  â”‚ (í•˜ì´ë“œë ˆì´ì…˜)â”‚  â”‚  (Review)   â”‚                          â”‚
â”‚  â”‚             â”‚  â”‚             â”‚                          â”‚
â”‚  â”‚ #3 HIGH    â”‚  â”‚ #8 MEDIUM  â”‚ â† ë™ì‹œ ê°€ëŠ¥               â”‚
â”‚  â”‚     â†“       â”‚  â”‚ #13 MEDIUM â”‚                          â”‚
â”‚  â”‚ #5 MEDIUM  â”‚  â”‚             â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê·¸ë£¹ A: ì™„ì „ ë…ë¦½ (ì„œë¡œ ì˜ì¡´ì„± ì—†ìŒ)

ì–¸ì œë“  ë‹¤ë¥¸ ì‘ì—…ê³¼ ë³‘ë ¬ë¡œ ì§„í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.

| ì´ìŠˆ | ì‹¬ê°ë„ | íŒŒì¼ | ë…ë¦½ ì´ìœ  |
|------|--------|------|----------|
| **#4** TipTap JSON ìºì‹œ ë™ê¸°í™” | CRITICAL | `projectStore.ts` | ì—ë””í„° â†” store ë™ê¸°í™” ë¬¸ì œ, ë‹¤ë¥¸ ì´ìŠˆì™€ ë¬´ê´€ |
| **#6** ê²€ìˆ˜ í•˜ì´ë¼ì´íŠ¸ ì˜¤í”„ì…‹ | MEDIUM | `reviewStore.ts` | Review ì „ìš© ë¡œì§ |
| **#10** Document Tools null ì²´í¬ | LOW | `documentTools.ts` | ë‹¨ìˆœ ë°©ì–´ ì½”ë“œ ì¶”ê°€ |
| **#12** composerAttachments ì •ë¦¬ | LOW | `chatStore.ts` | finally ë¸”ë¡ ì¶”ê°€, ë…ë¦½ì  ìˆ˜ì • |

### ê·¸ë£¹ B: chatStore ìŠ¤íŠ¸ë¦¬ë° ê´€ë ¨ (ìˆœì°¨ ì§„í–‰)

ìŠ¤íŠ¸ë¦¬ë° ê¸°ë°˜ ë¡œì§ì´ë¯€ë¡œ ìˆœì°¨ ì§„í–‰ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

| ìˆœì„œ | ì´ìŠˆ | ì‹¬ê°ë„ | ì˜ì¡´ ì´ìœ  |
|------|------|--------|----------|
| 1 | **#1** ìŠ¤íŠ¸ë¦¬ë° finalization race | HIGH | ê¸°ë°˜ ë¬¸ì œ, ë¨¼ì € í•´ê²° í•„ìš” |
| 2 | **#11** ìŠ¤íŠ¸ë¦¬ë° ë©”íƒ€ë°ì´í„° ì†ì‹¤ | MEDIUM | #1ì˜ `finalizeStreaming()` ìˆ˜ì •ê³¼ ì—°ê´€ |
| 3 | **#7** ë¶ˆì™„ì „í•œ ì—ëŸ¬ ë³µêµ¬ | MEDIUM | ìŠ¤íŠ¸ë¦¬ë° ì—ëŸ¬ ì²˜ë¦¬, #1 ì™„ë£Œ í›„ ìˆ˜ì • |

**ì§„í–‰ ìˆœì„œ**: `#1` â†’ `#11` â†’ `#7`

### ê·¸ë£¹ C: AbortController / ìš”ì²­ ê´€ë¦¬ (ìˆœì°¨ ì§„í–‰)

abort ë©”ì»¤ë‹ˆì¦˜ê³¼ persist íƒ€ì´ë°ì´ ì—°ê´€ë©ë‹ˆë‹¤.

| ìˆœì„œ | ì´ìŠˆ | ì‹¬ê°ë„ | ì˜ì¡´ ì´ìœ  |
|------|------|--------|----------|
| 1 | **#2** AbortController ì •ë¦¬ ëˆ„ë½ | HIGH | abort ë©”ì»¤ë‹ˆì¦˜ ê¸°ë°˜ ë¬¸ì œ |
| 2 | **#9** ì±„íŒ… ì €ì¥ debounce race | HIGH | abortì™€ persist íƒ€ì´ë° ê´€ë ¨ |

**ì§„í–‰ ìˆœì„œ**: `#2` â†’ `#9`

### ê·¸ë£¹ D: í”„ë¡œì íŠ¸/í•˜ì´ë“œë ˆì´ì…˜ ê´€ë ¨ (ìˆœì°¨ ì§„í–‰)

í”„ë¡œì íŠ¸ ì „í™˜ ë¡œì§ì´ ì—°ê´€ë©ë‹ˆë‹¤.

| ìˆœì„œ | ì´ìŠˆ | ì‹¬ê°ë„ | ì˜ì¡´ ì´ìœ  |
|------|------|--------|----------|
| 1 | **#3** í”„ë¡œì íŠ¸ í•˜ì´ë“œë ˆì´ì…˜ race | HIGH | ê¸°ë°˜ ë¡œì§ ìˆ˜ì • |
| 2 | **#5** pendingDocDiff ë¯¸ì •ë¦¬ | MEDIUM | #3ì˜ `switchProjectById` ìˆ˜ì •ê³¼ ì—°ê´€ |

**ì§„í–‰ ìˆœì„œ**: `#3` â†’ `#5`

### ê·¸ë£¹ E: Review ì»´í¬ë„ŒíŠ¸ (ë³‘ë ¬ ê°€ëŠ¥)

ê°™ì€ íŒŒì¼ì´ì§€ë§Œ ìˆ˜ì • ìœ„ì¹˜ê°€ ë‹¤ë¦…ë‹ˆë‹¤.

| ì´ìŠˆ | ì‹¬ê°ë„ | íŒŒì¼ | ìˆ˜ì • ë‚´ìš© |
|------|--------|------|----------|
| **#8** ê²€ìˆ˜ ì—ëŸ¬ ë¡¤ë°± ì—†ìŒ | MEDIUM | `ReviewPanel.tsx` | try-catch ì¶”ê°€ |
| **#13** ë²ˆì—­ ê·œì¹™ ìŠ¤ëƒ…ìƒ· | MEDIUM | `ReviewPanel.tsx` | hook ì‚¬ìš©ë²• ìˆ˜ì • |

**ë™ì‹œ ì§„í–‰ ê°€ëŠ¥** (ìˆ˜ì • ìœ„ì¹˜ ì¶©ëŒ ì—†ìŒ)

---

### ê¶Œì¥ ì§„í–‰ ê³„íš

#### Phase 1: 5ê°œ ë³‘ë ¬ íŠ¸ë™

ìµœëŒ€ 5ê°œ íŠ¸ë™ì„ ë™ì‹œì— ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| íŠ¸ë™ | ì´ìŠˆ | ë‹´ë‹¹ ì˜ì—­ | ë³µì¡ë„ | ì˜ˆìƒ ìˆ˜ì • ë²”ìœ„ |
|------|------|----------|--------|---------------|
| **Track 1** | #4 | projectStore + ì—ë””í„° ì—°ë™ | High | TipTap onUpdate ì½œë°± ìˆ˜ì •, ìºì‹œ ë™ê¸°í™” |
| **Track 2** | #1 â†’ #11 â†’ #7 | chatStore ìŠ¤íŠ¸ë¦¬ë° | High | finalizeStreaming, ì—ëŸ¬ ì²˜ë¦¬ |
| **Track 3** | #2 â†’ #9 | chatStore abort/persist | Medium | AbortController ê´€ë¦¬, debounce ë¡œì§ |
| **Track 4** | #3 â†’ #5 | projectStore í•˜ì´ë“œë ˆì´ì…˜ | Medium | hydrateForProject, switchProjectById |
| **Track 5** | #8 + #13 | ReviewPanel | Low | try-catch, hook íŒ¨í„´ |

```
Timeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Track 1: [====== #4 CRITICAL ======]
Track 2: [=== #1 HIGH ===][== #11 ==][== #7 ==]
Track 3: [=== #2 HIGH ===][=== #9 HIGH ===]
Track 4: [=== #3 HIGH ===][== #5 ==]
Track 5: [== #8 ==][== #13 ==]  (ë³‘ë ¬ ê°€ëŠ¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### Phase 2: ë…ë¦½ ì´ìŠˆ (ì–¸ì œë“  ì§„í–‰)

Phase 1ê³¼ ë³‘ë ¬ë¡œ, ë˜ëŠ” ì´í›„ì— ì§„í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.

| ì´ìŠˆ | ë³µì¡ë„ | ìˆ˜ì • ë‚´ìš© |
|------|--------|----------|
| #6 | Low | ë¬¸ì„œ í¸ì§‘ ì‹œ í•˜ì´ë¼ì´íŠ¸ ë¬´íš¨í™” |
| #10 | Low | null ì²´í¬ ì¶”ê°€ |
| #12 | Low | finally ë¸”ë¡ìœ¼ë¡œ ì´ë™ |

---

### ìš”ì•½ í…Œì´ë¸”

| êµ¬ë¶„ | ì´ìŠˆ ìˆ˜ | ì´ìŠˆ ë²ˆí˜¸ | ë¹„ê³  |
|------|--------|----------|------|
| **ì™„ì „ ë…ë¦½** | 4ê°œ | #4, #6, #10, #12 | ì–¸ì œë“  ë³‘ë ¬ ì§„í–‰ |
| **ê·¸ë£¹ ë‚´ ìˆœì°¨** | 9ê°œ | B: #1â†’#11â†’#7 | ìŠ¤íŠ¸ë¦¬ë° ê´€ë ¨ |
| | | C: #2â†’#9 | Abort ê´€ë ¨ |
| | | D: #3â†’#5 | í•˜ì´ë“œë ˆì´ì…˜ ê´€ë ¨ |
| | | E: #8+#13 | Review (ë³‘ë ¬ ê°€ëŠ¥) |

**ìµœëŒ€ ë™ì‹œ ì§„í–‰ ê°€ëŠ¥**: 5ê°œ íŠ¸ë™

---

### ìš°ì„ ìˆœìœ„ ê¶Œì¥

ì‹¬ê°ë„ì™€ ì˜ì¡´ì„±ì„ ê³ ë ¤í•œ ê¶Œì¥ ì§„í–‰ ìˆœì„œ:

1. **ì¦‰ì‹œ ì‹œì‘** (CRITICAL/HIGH, ë…ë¦½ì )
   - Track 1: #4 (CRITICAL) - ê°€ì¥ ì‹¬ê°, ë…ë¦½ì ìœ¼ë¡œ ì§„í–‰ ê°€ëŠ¥

2. **í•¨ê»˜ ì‹œì‘** (HIGH, ê·¸ë£¹ ì„ í–‰ ì´ìŠˆ)
   - Track 2: #1 (HIGH) - ìŠ¤íŠ¸ë¦¬ë° ê¸°ë°˜ ë¬¸ì œ
   - Track 3: #2 (HIGH) - Abort ê¸°ë°˜ ë¬¸ì œ
   - Track 4: #3 (HIGH) - í•˜ì´ë“œë ˆì´ì…˜ ê¸°ë°˜ ë¬¸ì œ

3. **í›„ì† ì§„í–‰** (MEDIUM, ê·¸ë£¹ í›„í–‰ ì´ìŠˆ)
   - Track 2: #11, #7 (#1 ì™„ë£Œ í›„)
   - Track 3: #9 (#2 ì™„ë£Œ í›„)
   - Track 4: #5 (#3 ì™„ë£Œ í›„)
   - Track 5: #8, #13 (ì–¸ì œë“ )

4. **ì—¬ìœ  ì‹œ ì§„í–‰** (LOW)
   - #6, #10, #12

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| 2025-01-14 | 1.0 | ì´ˆê¸° ë¶„ì„ ë¬¸ì„œ ì‘ì„± |
| 2025-01-14 | 1.1 | ë³‘ë ¬ ì§„í–‰ ì „ëµ ì„¹ì…˜ ì¶”ê°€ |
