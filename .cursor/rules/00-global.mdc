---
description: 프로젝트 전역 규칙. PRD/TRD를 Source of Truth로 준수하며, 한국어 응답, Non-Intrusive AI, Docs-first 원칙을 따른다.
globs: "**/*"
alwaysApply: true
---

# 전역 규칙 (Global Rules)

이 파일은 프로젝트 전체에 적용되는 핵심 원칙입니다. 상세 스펙은 `prd.md`와 `docs/trd/`를 **단일 Source of Truth**로 참조합니다.

---

## 0. Source of Truth / 불확실성 처리

- 최상위 기준 문서: `prd.md`, `docs/trd/` (README.md가 인덱스)
- 코드/다른 문서/규칙이 PRD/TRD와 충돌하면 **PRD/TRD에 맞춰 정리**
- 불확실하거나 큰 설계 변경이 필요하면 **추측하지 말고 확인 질문**

---

## 1. 커뮤니케이션 (Assistant 동작)

- **항상 한국어로** 응답
- 사용자의 명시적 요청 전 **과도한 제안/자동 진행 금지** (Non-Intrusive)
- 변경은 **최소 단위로** 수행하고, **이유/의도/리스크**를 함께 설명
- 코드 변경 시 관련 파일을 먼저 읽고 이해한 후 진행

---

## 2. 제품/UX 원칙

- **Document-First**: 번역가는 "문서 편집"에 집중
- **3 패널 레이아웃**: Source / Target / AI(Chat). Focus Mode로 Source 숨김 지원
- **Keyboard-First**: 핵심 플로우는 단축키 중심
- **사용자 주도 편집**: AI는 조력자이며, 문서 자동 변경/자동 적용 금지

---

## 3. AI 인터랙션 (필수 제약)

- AI는 **요청 시에만** 응답
- 채팅은 **문서에 자동 적용하지 않음** — 번역은 Translate(Preview→Apply)로 유도
- "Add to chat"은 **선택 텍스트를 채팅 입력으로 옮기는 보조 UX**이며, 단독으로 모델 호출 발생 금지
- 출력 포맷 (상세는 PRD/TRD 준수):
  - 번역(문서 전체): Markdown (`---TRANSLATION_START/END---` 마커)
  - 질문/검수: 간결한 답변 또는 JSON 리포트

---

## 4. Docs-first 작업 순서

- 기능/UX 변경 시 **먼저 `prd.md`/`docs/trd/` 업데이트** → 그 명세에 맞춰 구현
- 구현 후 관련 작업 문서(예: `tasks/`) 최신 상태로 동기화

---

## 5. 기술/데이터/보안 원칙

- 아키텍처/스택/저장 규칙: **`docs/trd/` 준수**
- **TipTap JSON이 문서의 canonical format** (HTML/Markdown은 변환용)
- Rust ↔ React IPC는 저지연 우선, 대용량 저장 시 **UI 프리즈 방지**
- API 키/토큰 등 비밀정보: **하드코딩 금지** (OS keychain 사용)
- 환경변수(`VITE_*`)는 보안 목적으로 사용하지 않음

---

## 6. Git 워크플로우

- 안정적인 변경 완료 시 **커밋 리마인드** (자동 실행 금지)
- Conventional Commits 형식 사용:
  - `feat:` 새 기능
  - `fix:` 버그 수정
  - `docs:` 문서
  - `refactor:` 리팩토링
  - `test:` 테스트 추가
  - `chore:` 유지보수

---

## 7. 터미널 실행 정책

- **Watch 모드 명령어 금지**: `npm run dev`, `npm start`, `jest --watch`, `nodemon` 등
- 서버 시작 전 **포트 사용 여부 확인** 및 사용자 확인
- 장시간 실행 명령어는 백그라운드로 실행
- `npm run build`는 1-2분 소요 예상, 5분 초과 시 수동 취소 권장

---

## 8. Context7 MCP 사용

- 라이브러리 문서 조회 필요 시 **Context7 도구 자동 사용**
- 순서: `resolve-library-id` → `get-library-docs`
- 적용 대상: React, TipTap, LangChain, Tauri, Zustand 등 주요 라이브러리
- 코드 생성, 설정, API 문서 필요 시 자동 조회

---

## 9. i18n (국제화)

- UI 문자열은 `src/i18n/locales/ko.json`, `en.json`에 키 추가
- 두 파일 모두 동기화 필수
- 키 네이밍: dot notation (예: `chat.send`, `settings.apiKey`)
