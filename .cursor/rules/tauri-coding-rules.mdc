---
description: Tauri 데스크톱 앱 개발 규칙. Rust 백엔드 커맨드(tauri::command), IPC(invoke), permissions/capabilities(v2), 파일시스템, 윈도우 관리 등.
globs:
  - "src-tauri/src/**"
  - "src-tauri/Cargo.toml"
  - "src-tauri/tauri.conf.json"
  - "src-tauri/capabilities/**"
alwaysApply: false
---

# Tauri 데스크톱 앱 개발 규칙

이 프로젝트는 **Tauri v2** 기준입니다. 보안/권한/IPC는 TRD를 Source of Truth로 따릅니다.

## 1. 핵심 원칙

- PRD/TRD가 최상위 기준이며 충돌 시 문서 기준으로 정리
- 보안/정확성 우선, 변경은 최소 단위로
- 불확실하거나 큰 변경은 사전 확인

## 2. IPC/Command 규칙

- 모든 프론트 노출 함수는 `tauri::command`로 구현
- 입력 검증/에러 처리를 명확히 (`Result<T, E>`, `thiserror` 권장)
- `tauri::State`로 의존성 주입
- I/O는 `tokio` 기반 async 처리, UI 프리즈 방지
- 에러 메시지는 사용자 친화적으로, 시크릿은 절대 로그 금지

## 3. 권한/Capabilities (v2)

- 권한은 **capabilities JSON**에서 정의하고 `tauri.conf.json`에서 참조
- 최소 권한 원칙: 필요한 window/webview/path만 스코프 제한
- 파일 시스템은 공식 플러그인 + 스코프 사용 (deny-by-default)

## 4. 파일 시스템/저장

- 프로젝트는 SQLite 기반 `.ite` 단일 파일로 관리
- 내부 데이터는 `app_data_dir` 하위에 저장
- 경로 검증 필수: 경로 traversal 및 시스템 디렉토리 접근 차단

## 5. SecretManager/Vault

- API Key/OAuth 토큰은 **SecretManager Vault**에 저장
- Keychain에는 마스터키만 저장, 시크릿은 `secrets.vault`에 암호화 저장
- localStorage/DB/`.ite` export에 시크릿 포함 금지
- 로그에는 `[REDACTED]` 마스킹

## 6. OAuth/MCP (Confluence/Notion)

- Confluence: Rust 네이티브 SSE + OAuth 2.1 PKCE (lazy auth)
- Notion: MCP 기반 연결/해제, 토큰은 Vault에 영속화
- OAuth 콜백 서버는 타임아웃/정리 로직으로 리소스 누수 방지

## 7. TypeScript 래퍼 연동

- `src/tauri/*.ts`는 Rust 커맨드와 1:1 매핑
- 시그니처/파라미터/타입 동기화 필수
- `invoke` 에러는 try-catch로 처리하고 사용자 메시지로 변환

## 8. 로깅/안정성

- `tauri-plugin-log`로 구조화 로깅 (민감 정보 제외)
- 실패 시 안전한 폴백과 명확한 에러 메시지 제공
