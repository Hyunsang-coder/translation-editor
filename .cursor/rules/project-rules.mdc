---
description: project-rules
globs: "**/*"
alwaysApply: true
---
이 프로젝트의 최상위 기준 문서(Source of Truth)는 `prd.md` 와 `trd.md` 입니다.
다른 문서(README/ENV/tasks/progress 등) 및 코드가 이 문서들과 충돌하면, 원칙적으로 PRD/TRD에 맞추어 수정합니다.
불확실하거나 큰 설계 변경이 필요한 경우에는 먼저 질문으로 확인합니다.

---

## 0) 응답/커뮤니케이션 원칙
- 항상 한국어로 답합니다.
- 사용자가 명시적으로 요청(버튼/메뉴/단축키 등)하기 전에는 과도한 제안/개입을 하지 않습니다(Non-Intrusive AI).
- 확신 없는 내용은 추측하지 말고 확인 질문을 먼저 합니다.
- 변경은 최소 단위로, 이유/의도/리스크를 함께 설명합니다.

---

## 1) 제품 목표(PRD) 기반 UX 원칙
- **Document-First**: 번역가는 "문서 편집"에 집중해야 합니다. 복잡한 그리드/과한 UI를 피합니다.
- **3 패널**: Source(참조) / Target(편집) / AI(Chat). Focus Mode로 Source를 숨길 수 있어야 합니다.
- **Keyboard-First**: 핵심 플로우는 단축키 중심으로 설계합니다.
- **사용자 주도 편집**: 번역가는 직접 문서를 수정하며, AI는 조력자 역할만 수행합니다. AI가 자동으로 문서를 변경하지 않습니다.

---

## 2) 기술 목표(TRD) 기반 아키텍처 원칙
### 2.1 Tech Stack(목표)
- **Desktop**: Tauri + Rust
- **Frontend**: React + TypeScript
- **Editor**: TipTap (ProseMirror 기반) - Source/Target 2개 인스턴스
- **State**: Zustand (+ 필요 시 Immer)
- **Storage**: SQLite(rusqlite) 기반 단일 `.ite` 프로젝트 파일

### 2.2 TipTap 에디터 구성
- **Source/Target 패널**: TipTap 편집 가능 (Focus Mode로 Source를 숨길 수 있음)
- **공통 스타일**: Notion 감성 (Pretendard 폰트, 행간 1.8, 16px, max-width 800px)

### 2.3 지원 포맷
- 헤딩 (H1-H6)
- 불릿 리스트 / 번호 리스트
- 볼드, 이탤릭, 취소선
- 인용 블록 (Blockquote)
- 코드 블록 (선택적)
- 하이퍼링크

---

## 3) AI 인터랙션
### 3.1 핵심 원칙
- AI는 요청 시에만 응답 (Non-Intrusive)
- 번역사가 주도권을 가지고, AI는 조력자 역할만 수행합니다.
- 번역문 수정은 사용자가 직접 수행하므로, AI가 자동으로 문서를 변경하지 않습니다.
- 번역 vs 질문 구분: 채팅 탭 분리 권장
- 간결한 응답: 불필요한 설명 없이 핵심만

### 3.2 On-Demand 트리거(요청 기반)
- 사용자의 **명시적 요청(버튼/메뉴/단축키 등)** 없이 자동 리라이트/자동 적용은 금지합니다.
- "Add to chat"은 **선택 텍스트를 프롬프트(채팅 입력)로 옮기는 보조 UX**이며, 단독으로 모델 호출을 발생시키지 않습니다.

### 3.3 프롬프트/컨텍스트(=Context Collection)
- 컨텍스트는 **선택 영역(가능하면) + 원문/번역 맥락 + 용어집/참조 문서 + Active Memory(톤/스타일/용어 규칙)** 순으로 구성합니다.
- **원문 컨텍스트(Source)**는 최우선으로 payload에 포함합니다.
- 필요 시 최근 채팅 메시지(최대 10개)를 포함할 수 있습니다.
- 출력 포맷 강제:
  - 번역(문서 전체): TipTap JSON만 출력(설명 없이)
  - 질문/검수: 간결한 답변 또는 JSON 리포트
- 확정된 용어/스타일 규칙은 Translation Rules/Active Memory에 축적하여 일관성을 유지합니다.

---

## 3.4 Docs-First 작업 순서(필수)
- 기능/UX 변경이 있으면 **먼저 `prd.md`/`trd.md`를 업데이트**하고, 그 명세에 맞춰 코드를 구현합니다.
- 코드/문서가 충돌하면 **`prd.md`/`trd.md`가 우선**입니다.

## 3.5 Chat 기능 범위(필수)
- **채팅은 문서에 자동 적용하지 않습니다.** 번역은 Translate(Preview→Apply)로 유도합니다.
- 검수/리뷰/검증(누락/오역/일관성/톤) 요청은 수행할 수 있습니다.
- 채팅 메시지는 가독성을 위해 **Markdown(GFM) 렌더링**을 허용합니다. (HTML 렌더링 금지)
- assistant 응답이 **스타일/톤/번역 규칙** 성격일 때만 `Add to Rules` 버튼을 노출하며, 클릭 시 `Translation Rules`에 **빈 줄(\\n\\n) 포함 append**합니다.
- 메시지 수정/삭제 시에는 해당 메시지 이후 대화가 **truncate**되어야 합니다(맥락 일관성). `editedAt`, `originalContent` 보관을 권장합니다.

---

## 4) 데이터/저장 규칙(.ite)
- 프로젝트/문서/대화/스냅샷은 SQLite를 기준으로 영속화합니다.
- TipTap JSON 형식으로 에디터 내용 저장 (SQLite `documents` 테이블의 JSON 컬럼)
- 자동 저장(Auto-save)은 사용자 경험을 해치지 않는 선에서 동작해야 합니다(지연/스레드/락 주의).
- Rust ↔ React IPC는 지연시간을 최소화하고, 대용량 저장 시에도 UI가 멈추지 않게 합니다.

---

## 5) 코드 변경 시 준수사항(실무 규율)
- PRD/TRD와 충돌하는 구현을 추가하지 않습니다. 필요한 경우 먼저 질문합니다.
- 변경 전에 관련 파일을 탐색하고, 이미 있는 유틸/스토어/타입을 재사용합니다(DRY).
- UX/성능 목표(60fps, 저지연 IPC)를 해치지 않도록 불필요한 리렌더/큰 상태를 피합니다.
- 보안: API 키/토큰은 코드/문서에 하드코딩하지 않습니다. `.env.local` 등 로컬 환경변수로만 관리합니다.

---

## 6) 문서 운영 규칙
- 문서 간 충돌이 생기면 `prd.md`/`trd.md`를 기준으로 정리합니다.
- README에는 “목표 아키텍처(=PRD/TRD)”와 “현재 구현 현황(있는 경우)”을 명확히 분리해서 적습니다.
